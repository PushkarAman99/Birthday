<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Happy Birthday Vaibhavi ‚ù§Ô∏è</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
  margin:0;
  overflow:hidden;
  background:radial-gradient(circle at center,#1a0f0f,#0a0a12);
  font-family:sans-serif;
  touch-action:manipulation;
}
#ui{
  position:absolute;
  bottom:20px;
  width:100%;
  text-align:center;
}
button{
  padding:10px 18px;
  margin:5px;
  font-size:14px;
  border:none;
  border-radius:25px;
  cursor:pointer;
  background:linear-gradient(45deg,#7a2f1b,#d2691e);
  color:white;
  box-shadow:0 4px 15px rgba(0,0,0,0.4);
}
</style>
</head>
<body>

<div id="ui">
  <button onclick="blowCandle()">Blow üïØÔ∏è</button>
  <button onclick="cutCake()">Cut üî™</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://threejs.org/examples/js/loaders/FontLoader.js"></script>
<script src="https://threejs.org/examples/js/geometries/TextGeometry.js"></script>

<script>
let scene = new THREE.Scene();
scene.fog = new THREE.Fog(0x0a0a12, 15, 60);

let camera = new THREE.PerspectiveCamera(50, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.set(0,6,20);

let renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.setPixelRatio(Math.min(window.devicePixelRatio,2));
renderer.shadowMap.enabled = true;
document.body.appendChild(renderer.domElement);

// Lighting
scene.add(new THREE.AmbientLight(0xffe6cc,0.4));
let light = new THREE.PointLight(0xffaa55,3,30);
light.position.set(0,10,8);
scene.add(light);

// Chocolate Cake
let cakeMaterial = new THREE.MeshStandardMaterial({
  color:0x3b1f14,
  roughness:0.4,
  metalness:0.3
});
let cake = new THREE.Mesh(
  new THREE.CylinderGeometry(4,4,2.5,64),
  cakeMaterial
);
scene.add(cake);

let cream = new THREE.Mesh(
  new THREE.CylinderGeometry(4.2,4.2,0.6,64),
  new THREE.MeshStandardMaterial({color:0xf5e6d3})
);
cream.position.y=1.6;
scene.add(cream);

// Chocolate drip
for(let i=0;i<15;i++){
  let drip = new THREE.Mesh(
    new THREE.CylinderGeometry(0.2,0.2,Math.random()*1+0.5,16),
    cakeMaterial
  );
  drip.position.set(Math.cos(i)*3.8,1.2,Math.sin(i)*3.8);
  scene.add(drip);
}

// Candle
let candle = new THREE.Mesh(
  new THREE.CylinderGeometry(0.25,0.25,2.5,32),
  new THREE.MeshStandardMaterial({color:0xffffff})
);
candle.position.y=3;
scene.add(candle);

// -------- Realistic Flickering Flame --------
let flame = new THREE.Group();
scene.add(flame);

let flameLight = new THREE.PointLight(0xffaa33,2,10);
flameLight.position.y = 4.3;
scene.add(flameLight);

function createFlameCone(scale=1){
  let coneGeo = new THREE.ConeGeometry(0.3*scale,1*scale,32);
  let coneMat = new THREE.MeshBasicMaterial({color:0xffff66,transparent:true,opacity:0.8,side:THREE.DoubleSide});
  let cone = new THREE.Mesh(coneGeo,coneMat);
  cone.position.y = 4.3;
  flame.add(cone);
  return cone;
}

// Two overlapping cones for inner+outer flame
let flameInner = createFlameCone(0.6);
let flameOuter = createFlameCone(1);

// -------- Rose Petals --------
function createPetalTexture(){
  let canvas = document.createElement('canvas');
  canvas.width = 128; canvas.height = 128;
  let ctx = canvas.getContext('2d');
  let gradient = ctx.createRadialGradient(64,64,20,64,64,60);
  gradient.addColorStop(0,"#ff8fa3");
  gradient.addColorStop(1,"#c9184a");
  ctx.fillStyle = gradient;
  ctx.beginPath();
  ctx.moveTo(64,20);
  ctx.bezierCurveTo(110,40,110,90,64,110);
  ctx.bezierCurveTo(18,90,18,40,64,20);
  ctx.fill();
  return new THREE.CanvasTexture(canvas);
}
let petalTexture = createPetalTexture();
let petals=[];
for(let i=0;i<60;i++){
  let geo = new THREE.PlaneGeometry(0.6,0.8,10,10);
  let pos = geo.attributes.position;
  for(let j=0;j<pos.count;j++){
    let y = pos.getY(j); pos.setZ(j, Math.sin(y*5)*0.1);
  }
  let mat = new THREE.MeshPhongMaterial({map:petalTexture,transparent:true,side:THREE.DoubleSide});
  let petal = new THREE.Mesh(geo,mat);
  petal.position.set((Math.random()-0.5)*20,Math.random()*15+5,(Math.random()-0.5)*20);
  petal.userData = {speed:0.01+Math.random()*0.02,sway:Math.random()*0.02,rotationSpeed:(Math.random()-0.5)*0.05};
  petals.push(petal); scene.add(petal);
}

// Fireworks
let fireworks = new THREE.Points(
  new THREE.BufferGeometry().setAttribute('position',
    new THREE.Float32BufferAttribute(Array.from({length:500},()=> (Math.random()-0.5)*20 ),3)),
  new THREE.PointsMaterial({color:0xff69b4,size:0.15})
);
fireworks.visible=false; scene.add(fireworks);

// Knife
let knife = new THREE.Mesh(
  new THREE.BoxGeometry(0.2,0.8,5),
  new THREE.MeshStandardMaterial({
    color:0xc0c0c0,      // metallic silver
    metalness:0.9,       // high reflectivity
    roughness:0.2,       // slight roughness
    envMapIntensity:0.8
  })
);

knife.position.set(-8,3,0); scene.add(knife);

let slice = new THREE.Mesh(
  new THREE.CylinderGeometry(4,4,2.5,64,1,false,0,Math.PI/6),
  cakeMaterial
);
slice.visible=false; scene.add(slice);

let cutting=false;
let shake=false;
let shakeStart=0;

// Text
new THREE.FontLoader().load(
'https://threejs.org/examples/fonts/helvetiker_regular.typeface.json',
function(font){
  let text = new THREE.Mesh(
    new THREE.TextGeometry("Happy Birthday Vaibhavi",{font:font,size:0.8,height:0.2}),
    new THREE.MeshStandardMaterial({color:0xff6f91})
  );
  text.position.set(-5,6,0); scene.add(text);
});

// Actions
function blowCandle(){
  flame.visible=false;
  flameInner.visible=false;
  flameOuter.visible=false;
  flameLight.visible=false;
  fireworks.visible=true;
}

function cutCake(){
  cutting=true; shake=true; shakeStart=Date.now();
}

// Mobile tap support
window.addEventListener("touchstart",()=>{
  if(flameInner.visible) blowCandle(); else cutCake();
});

// Animate
function animate(){
  requestAnimationFrame(animate);
  cake.rotation.y+=0.002; cream.rotation.y+=0.002;

  // Flame flicker
  if(flameInner.visible){
    let f = 0.2*Math.sin(Date.now()*0.02);
    flameInner.scale.set(0.6+f,0.6+f,0.6+f);
    flameOuter.scale.set(1+f,1+f,1+f);
    flameLight.intensity = 2+f*2;
  }

  // Petals
  petals.forEach(p=>{
    p.position.y -= p.userData.speed;
    p.position.x += Math.sin(Date.now()*0.001)*p.userData.sway;
    p.rotation.z += p.userData.rotationSpeed;
    p.rotation.x += p.userData.rotationSpeed*0.5;
    if(p.position.y<0){ p.position.y=15; p.position.x=(Math.random()-0.5)*20; }
  });

  // Knife cut
  if(cutting && knife.position.x<0) knife.position.x+=0.15;
  else if(cutting){ slice.visible=true; slice.position.x=2.5; }

  // Camera shake stop after 5 sec
  if(shake){
    if(Date.now()-shakeStart<5000){ camera.position.x=Math.sin(Date.now()*0.05)*0.3; }
    else{ shake=false; camera.position.x=0; }
  }

  renderer.render(scene,camera);
}
animate();

window.addEventListener("resize",()=>{
  camera.aspect=window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth,window.innerHeight);
});
</script>
</body>
</html>
